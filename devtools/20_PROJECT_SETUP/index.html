<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Phase2">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Project Setup - DevTools CLI Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Project Setup";
    var mkdocs_page_input_path = "20_PROJECT_SETUP.md";
    var mkdocs_page_url = "/20_PROJECT_SETUP/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-305109-83', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> DevTools CLI Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../00_INTRO/">Introduction</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../10_TOOLCHAIN/">Tool Chain</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Project Setup</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#how-to-get-started">How to get started</a></li>
                
            
                <li class="toctree-l3"><a href="#get-ready-to-run-containers">Get ready to run containers</a></li>
                
            
                <li class="toctree-l3"><a href="#stopping-the-containers-for-your-project">Stopping the containers for your project</a></li>
                
            
                <li class="toctree-l3"><a href="#cleaning-up">Cleaning Up</a></li>
                
            
                <li class="toctree-l3"><a href="#setting-up-a-project">Setting up a project</a></li>
                
                    <li><a class="toctree-l4" href="#the-docker-compose-file">The docker-compose file</a></li>
                
                    <li><a class="toctree-l4" href="#dns-names-for-your-containers">DNS Names for your containers</a></li>
                
                    <li><a class="toctree-l4" href="#dns-forwarders">DNS Forwarders</a></li>
                
                    <li><a class="toctree-l4" href="#dns-command">DNS Command</a></li>
                
                    <li><a class="toctree-l4" href="#dns-debugging">DNS Debugging</a></li>
                
                    <li><a class="toctree-l4" href="#working-with-volumes">Working with Volumes</a></li>
                
                    <li><a class="toctree-l4" href="#resetting-a-docker-container">Resetting a Docker Container</a></li>
                
                    <li><a class="toctree-l4" href="#creating-a-dockerfile">Creating a Dockerfile</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../30_PROJECT_USAGE/">Project Usage</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../30_XDEBUG/">Xdebug</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../40_INTEGRATION/">Integration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../50_TROUBLESHOOTING/">Troubleshooting</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../60_FAQ/">FAQ</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../70_UPGRADE/">Upgrade</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../99_LINUX/">LINUX</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">DevTools CLI Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Project Setup</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://bitbucket.org/phase2tech/devtools-cli/src/default/docs/20_PROJECT_SETUP.md"
          class="icon icon-bitbucket"
        > Edit on Bitbucket</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="how-to-get-started">How to get started</h2>
<ol>
<li>
<p>Install DevTools via Homebrew. First, tap the Homebrew repository <code>brew tap phase2/devtools</code>, then install DevTools <code>brew install devtools</code>. </p>
</li>
<li>
<p>Follow the instructions in the <a href="..">DevTools Index</a> to get your environment configured. All of the following sample commands will assume you've installed things as suggested in the README.</p>
</li>
</ol>
<h2 id="get-ready-to-run-containers">Get ready to run containers</h2>
<p>When you want to start the Docker containers for a project, do the following:</p>
<ol>
<li>
<p>Ensure the Docker Host VM is active by running: <code>devtools start</code></p>
<ul>
<li>This will create a Docker Host if one does not exist already</li>
<li>To customize this Docker Host you can provide the following configuration options.<ul>
<li><strong>name:</strong> The Docker Machine name for the VM. Defaults to <code>dev</code></li>
<li><strong>driver:</strong> The driver to create the Docker Machine with. Choices are <code>virtualbox</code>, <code>vmwarefusion</code>, and <code>xhyve</code>. Defaults to <code>virtualbox</code></li>
<li><strong>cpuCount:</strong> The number of virtual CPU you want to allocate to this VM. Defaults to 2</li>
<li><strong>memSize:</strong> The size memory you want to configure for this VM, in Megabytes. Defaults to 4096</li>
<li><strong>diskSize:</strong> The size drive you want to configure for this VM, in Gigabytes. Defaults to 40</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Ensure all terminals you intend to use have <code>eval "$(devtools config)"</code> run in them. It is best to put this configuration in your .bashrc/.zshrc, see the main <a href="..">DevTools Index</a> for more details. This command must be rerun after any start/restart of the Docker Host VM.</p>
</li>
<li>
<p>In the project directory, start the containers with: <code>docker-compose up</code></p>
<ol>
<li>
<p>Note: The docker-compose command runs in the foreground as long as the Docker containers are running. <strong>(It is not hung if there is no output after "Attaching [container name]...)</strong></p>
</li>
<li>
<p>Logs from the running containers will stream to the console and be prefixed by their compose names plus an integer (i.e. web_1, db_1, etc)</p>
</li>
</ol>
</li>
<li>
<p>Start another terminal if you need to run other commands (such as the build container cli)</p>
</li>
</ol>
<h2 id="stopping-the-containers-for-your-project">Stopping the containers for your project</h2>
<p>You may want to recoup the resources used by your projects containers and the docker host for other things if you are done with development for a while.  You can stop the containers for a single project only or all containers and the docker host depending on what you are finished using.</p>
<ol>
<li>
<p>If you only want to stop the containers for your project, in the project directory, run <code>docker-compose stop</code> or press Ctrl-C to stop a docker-compose process running in the foreground and then run <code>docker-compose stop</code> to ensure the project containers have stopped.</p>
</li>
<li>
<p>If you want to shut down the docker host as well as any containers, run <code>devtools stop</code></p>
</li>
</ol>
<h2 id="cleaning-up">Cleaning Up</h2>
<p>From time to time you'll want to clean up stopped containers. You'll also want to take special care when finishing a project to release all the resources used by it.</p>
<p>For periodic cleanup of all stopped containers, run the following script while your docker host is running: <code>devtools prune</code></p>
<p>If you only want to clean up project specific stopped containers, you can run: <code>docker-compose rm</code> from your project directory.</p>
<p>When you are finished with a project, if you used any persistent data storage you'll want to run a command to clean it up. The exact directory to request removal from will depend on your project (see suggested namespace guidelines in the TOOLCHAIN document): <code>docker ssh dev sudo rm -rf /data/PROJECT_DIR</code></p>
<h2 id="setting-up-a-project">Setting up a project</h2>
<p>To set up a project rather than just work on one, you'll need to understand how to create a docker-compose file, how to configure DNS for your project's containers and how to configure persistent storage if your project needs it.</p>
<h3 id="the-docker-compose-file">The docker-compose file</h3>
<p>Learn more about Docker Compose here: <a href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></p>
<p>Take a look at <a href="https://bitbucket.org/phase2tech/devtools-examples/src/master/drupal8/docker-compose.yml?fileviewer=file-view-default">example/drupal8</a> for an example docker-compose file</p>
<h3 id="dns-names-for-your-containers">DNS Names for your containers</h3>
<p>Within the <code>labels</code> section of the docker-compose file you can specify labels that will control the DNS name of your containers.  DNS names are in the format of <code>[name].[image].vm</code> (e.g web.devtools.vm)  </p>
<ul>
<li>
<p><code>com.dnsdock.name</code> - This is the type of container. Usually something like web, db, cache, etc.</p>
</li>
<li>
<p><code>com.dnsdock.image</code> - This is generally your project name (e.g devtools, drupal, etc.)</p>
</li>
<li>
<p>All DNS names devtools containers will end in <em>.vm</em></p>
</li>
</ul>
<p>If you need multiple domains mapped to a container you can use the <code>com.dnsdock.alias</code> setting. It takes a full domain name and can take a comma separated list (e.g. otherhost.devtools.vm or alexandria.phase2.vm). Additionally, dnsdock supports longer domain queries meaning if you have a service named web.devtools.vm, you can also use something.web.devtools.vm and it will resolve to the same IP address.</p>
<p>For all other DNS configuration options, please see the <a href="https://github.com/aacebedo/dnsdock#overrides-with-docker-labels">dnsdock label documentation</a></p>
<h3 id="dns-forwarders">DNS Forwarders</h3>
<p>DevTools can be configured to use additional name servers to forward DNS requests if the record cannot be resolved by dnsdock.</p>
<p>An example is if you connect to a VPN and need to resolve addresses to private servers within a VPN.  To enable this you need to configure the <code>DEVTOOLS_NAMESERVERS</code> environment variable to a comma separated list of <em>ip:port</em> (example: <code>10.10.7.2:53,8.8.8.8:53</code>) before running either <code>devtools start</code> or <code>devtools dns</code>. We suggest putting this env var configuration in your <code>~/.bashrc</code> or <code>~/.zshrc</code> so that it is always present when needed.  If you just need this temporarily, you can pass the configuration in with the <code>--nameservers</code> command line option to <code>devtools start</code> or <code>devtools dns</code>. </p>
<p>This configuration will try each forwarder name server, in order, to resolve names until success or all name servers have been exhausted.</p>
<h3 id="dns-command">DNS Command</h3>
<p>There is also a <code>devtools dns</code> command that will launch and configure our DNS services on any Docker Host. If you want to configure DNS on a Docker Host other than <em>dev</em> be sure to specify the <code>--name</code> parameter.</p>
<h3 id="dns-debugging">DNS Debugging</h3>
<p>If you want to see what containers have registered names, use the <code>devtools dns-records</code> command. This command will list all registered container names and aliases along with the container's IP address.</p>
<h3 id="working-with-volumes">Working with Volumes</h3>
<p>Volumes are a way that you can map directories or individual files into a running container.  This is useful to provide code to run for a generic container, or directories to store data that persist longer than the life of the container, or to even override directories and/or files that exist in an image.  Lets look at a few of those examples.</p>
<p><strong>Provide code for a generic container to run</strong></p>
<p>The default phase2/apache-php:php70 is a Web/PHP container that provides only an index file in <code>/var/www/html</code> that prints out phpinfo().  This is obviously not very useful for an application, so we can provide an entire Drupal site to run and we do that by mapping our site into the default docroot like this:</p>
<p><code>./build/html:/var/www/html</code></p>
<p>This takes the Drupal site we have in our local project directory of <code>build/html</code> and it overrides the default content of the images <code>/var/www/html</code> directory.</p>
<p><strong>Persist data longer than the life of the container</strong></p>
<p>When using a database like mysql the container will store the database files in <code>/var/lib/mysql</code> and by default that directory will be reset every time the container restarts. This means each time you restart your container you'd need to reinstall your application and database, which can make life difficult. So in order to persist mysql data for longer than the current run of the container we will map a directory from the Docker Host into the container and override the default <code>/var/lib/mysql</code> directory. The configuration will look something like this.</p>
<p><code>/data/drupal/mysql:/var/lib/mysql</code></p>
<p>Now when your database container creates files in <code>/var/lib/mysql</code> they are actually saved in the <code>/data/drupal/mysql</code> directory on the Docker Host. Be sure to namespace your directories inside /data so that separate projects don't conflict with each other. You'll also want to ensure you clean up when you are done with your project to keep from using up all of your disk space. See the cleaning up section for more info.</p>
<p><strong>Override directories and files that exist in an image</strong></p>
<p>Generally the configuration shipped with a Docker Image is meant to be the production configuration. Often, that configuration is not suitable for development and we need to override configurations.  With volumes we have shown earlier how you can override directories, but you can also override individual files too.</p>
<p><code>./config/dev/httpd/httpd.conf:/etc/httpd/httpd.conf</code></p>
<p>This takes a local <code>httpd.conf</code> file from our project and overrides the <code>/etc/httpd/httpd.conf</code> files that ships with the container. </p>
<h3 id="resetting-a-docker-container">Resetting a Docker Container</h3>
<p>If you change the docker-compose.yml configuration, for example to add/remove/change an environment variable, or you pull down a new version of a docker image, you can reset the Docker container simply by restarting.</p>
<p>However, if you wind up changing volume definitions in your docker-compose file you will need to remove your container before it will recognize those changes on a restart.</p>
<p>In the project directory, run: <code>docker-compose rm</code></p>
<p>This command will remove all stopped containers defined in the docker-compose.yml.  You could also  remove an individual container by running: <code>docker-compose rm &lt;name in yml&gt;</code></p>
<p>After removing the container, it will revert to the original state from the Docker image, removing any packages installed or files modified that are not included in a volume mount. Start your containers again with <code>docker-compose up</code> and you should have your new volume mounts.</p>
<h3 id="creating-a-dockerfile">Creating a Dockerfile</h3>
<p>The Dockerfile you create for your project should represent the application as it will need to run in production. There are many reasons to have a Dockerfile to create an image, but if you don't intend on running containers in production you can likely skip this part. </p>
<p>The most minimal project container will need to have your code in it.</p>
<ul>
<li>
<p>Start by determining which Docker image you will need to extend. </p>
</li>
<li>
<p>For the general Drupal use cases you will base your project Dockerfile on apache-php:php70.</p>
<ul>
<li><code>FROM phase2/apache-php:php70</code></li>
</ul>
</li>
<li>
<p>Then copy your code into the correct place for the container. For a PHP/Drupal project, copy the materialized site code into the container docroot</p>
<ul>
<li><code>COPY ./html /var/www/html/</code></li>
</ul>
</li>
<li>
<p>Build the Dockerfile into an image</p>
<ul>
<li><code>docker build -t &lt;some-name&gt; .</code></li>
</ul>
</li>
<li>
<p>On successful build, test the image by running</p>
<ul>
<li><code>docker run -t &lt;some-name&gt;</code></li>
</ul>
</li>
</ul>
<p>Here is the full (simple) Dockerfile</p>
<pre><code>FROM phase2/apache-php:php70

# Copy in the site
COPY ./html /var/www/html/
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../30_PROJECT_USAGE/" class="btn btn-neutral float-right" title="Project Usage">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../10_TOOLCHAIN/" class="btn btn-neutral" title="Tool Chain"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://bitbucket.org/phase2tech/devtools-cli" class="icon icon-bitbucket" style="float: left; color: #fcfcfc"> BitBucket</a>
      
      
        <span><a href="../10_TOOLCHAIN/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../30_PROJECT_USAGE/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
